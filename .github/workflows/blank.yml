name: 🎮 Epic Gaming Level Generator

on:
  schedule:
    - cron: '*/15 * * * *' # Every 15 minutes
  workflow_dispatch:

jobs:
  generate-level:
    name: 🕹️ GENERATE GAMING LEVEL
    runs-on: ubuntu-latest

    steps:
      - name: 🎲 Checkout Code
        uses: actions/checkout@v4

      - name: 🏆 GAMER LEVEL UNLOCKED BANNER
        run: |
          echo ""
          echo "░██████╗░░█████╗░███╗░░░███╗██╗███╗░░██╗░██████╗"
          echo "██╔════╝░██╔══██╗████╗░████║██║████╗░██║██╔════╝"
          echo "██║░░██╗░██║░░██║██╔████╔██║██║██╔██╗██║╚█████╗░"
          echo "██║░░╚██╗██║░░██║██║╚██╔╝██║██║██║╚████║░╚═══██╗"
          echo "╚██████╔╝╚█████╔╝██║░╚═╝░██║██║██║░╚███║██████╔╝"
          echo "░╚═════╝░░╚════╝░╚═╝░░░░░╚═╝╚═╝╚═╝░░╚══╝╚═════╝░"
          echo "        🚀 GAMER LEVEL UNLOCKED! 🚀"
          echo "           💥 POWER UP NOW! 💥"
          echo "        🏅 Claim your Victory! 🏅"
          echo ""

      - name: 👾 Generate Next Gaming Level (no ASCII)
        shell: bash
        run: |
          set -e

          gamer_names=(
            "RogueX" "Phantom" "Vortex" "BlazeFire" "NinjaX" "Shadow" "Drift" "Sonic" "Titan" "Nova"
            "Samurai" "Valkyrie" "Onyx" "Genesis" "Storm" "Inferno" "Thunder" "Astro" "Mirage" "Venom"
            "Frost" "Specter" "Matrix" "Glacier" "Eclipse" "Turbo" "Cosmos" "Ranger" "Prime" "Obsidian"
            "Falcon" "Zephyr" "Mystic" "Sentinel" "Cipher" "Ronin" "Aurora" "Stellar" "Galaxy" "Radiant"
            "Magma" "Golem" "Surge" "Elemental" "Oracle" "Echo" "Blizzard" "Phoenix" "Turbo" "Rogue"
          )

          mkdir -p levels

          last_name=""
          if ls levels/level-*-*.txt 1> /dev/null 2>&1; then
            last_file=$(ls levels/level-*-*.txt | sort | tail -n 1)
            last_name=$(basename "$last_file" | sed -E 's/level-[0-9]{8}-[0-9]{4}-(.*)\.txt/\1/')
          fi

          idx=0
          if [ -n "$last_name" ]; then
            for i in "${!gamer_names[@]}"; do
              if [[ "${gamer_names[$i]}" == "$last_name" ]]; then
                idx=$(( (i + 1) % ${#gamer_names[@]} ))
                break
              fi
            done
          fi

          next_name="${gamer_names[$idx]}"
          file_name="levels/level-$(date +%Y%m%d-%H%M)-${next_name}.txt"

          {
            echo "# 🎮 Gaming Level: $next_name"
            echo "# Generated at: $(date -u)"
            echo "# By: zayydenzi@gmail.com"
          } > "$file_name"

          echo "LEVEL_NAME=$next_name" >> $GITHUB_ENV
          echo "Created $file_name"

      - name: ⏰ Generate Formatted Time
        run: |
          echo "FORMATTED_TIME=$(TZ='Asia/Jakarta' date '+%d-%m-%Y %H:%M:%S WIB')" >> $GITHUB_ENV

      - name: 🔢 Generate Notification Counter
        id: notif-counter
        run: |
          count=$(ls levels/level-*-*.txt 2>/dev/null | wc -l)
          echo "NOTIF_COUNTER=$count" >> $GITHUB_ENV

      - name: 🕹️ Send Notification to Telegram
        uses: appleboy/telegram-action@v0.1.0
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            <b>░██████╗░░█████╗░███╗░░░███╗██╗███╗░░██╗░██████╗</b>
            <b>██╔════╝░██╔══██╗████╗░████║██║████╗░██║██╔════╝</b>
            <b>██║░░██╗░██║░░██║██╔████╔██║██║██╔██╗██║╚█████╗░</b>
            <b>██║░░╚██╗██║░░██║██║╚██╔╝██║██║██║╚████║░╚═══██╗</b>
            <b>╚██████╔╝╚█████╔╝██║░╚═╝░██║██║██║░╚███║██████╔╝</b>
            <b>░╚═════╝░░╚════╝░╚═╝░░░░░╚═╝╚═╝╚═╝░░╚══╝╚═════╝░</b>

            <b>🚀 GAMING LEVEL UNLOCKED!</b>
            <b>🎮 New Level:</b> <code>${{ env.LEVEL_NAME }}</code>
            <b>🗂️ Repository:</b> <code>${{ github.repository }}</code>
            <b>🕒 Time:</b> <code>${{ env.FORMATTED_TIME }}</code>
            <b>🔢 Notification Number:</b> <b>${{ env.NOTIF_COUNTER }}</b>
            <b>👤 Auto Commit By:</b> <b>zayydenzi@gmail.com</b>

            <b>#EpicGamer #NextLevel</b>
            <b>💯 This script was 100% created by Abie Haryatmo</b>
          format: html

      - name: 🤖 Configure Git
        run: |
          git config user.name "zayydenzi"
          git config user.email "zayydenzi@gmail.com"

      - name: 🚩 Commit & Push Changes
        run: |
          git add levels/
          git commit -m "🎮 Add Gaming Level: ${{ env.LEVEL_NAME }} (by zayydenzi@gmail.com)" || echo "Nothing to commit"
          git push
